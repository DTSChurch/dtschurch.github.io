<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>All Projects | DTS Dev Docs</title>
    <meta
      name="description"
      content="Browse all DTS Church development projects — Rock RMS plugins, workflows, and systems."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,500;9..144,700&family=Work+Sans:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="assets/styles.css" />
  </head>
  <body>
    <div class="site-bg" aria-hidden="true">
      <div class="glow glow-a"></div>
      <div class="glow glow-b"></div>
      <div class="grid-overlay"></div>
    </div>

    <header id="site-header"></header>

    <main class="page">
      <section class="hero reveal">
        <p class="eyebrow">Project Catalog</p>
        <h1>All projects</h1>
        <p>
          Browse every DTS Church development project. Use the search bar or
          filter by category to find what you need.
        </p>

        <div class="catalog-header">
          <input
            type="search"
            class="catalog-search"
            id="catalog-search"
            placeholder="Search projects…"
            autocomplete="off"
          />
          <div class="catalog-filters" id="catalog-filters"></div>
        </div>

        <div class="catalog-grid" id="catalog-grid"></div>
        <p class="catalog-empty" id="catalog-empty" hidden>
          No projects match your search.
        </p>
      </section>
    </main>

    <script src="assets/nav.js"></script>
    <script src="assets/site.js"></script>
    <script>
      (function () {
        // ── Project data (from nav.js — single source of truth) ──
        var CATALOG = window.DTS_CATALOG || [];

        // ── Gather unique groups ──────────────────────────────────
        var groups = [];
        CATALOG.forEach(function (p) {
          if (groups.indexOf(p.group) === -1) groups.push(p.group);
        });

        // ── Render filter chips ───────────────────────────────────
        var filtersEl = document.getElementById("catalog-filters");
        var chipAll = document.createElement("button");
        chipAll.className = "filter-chip is-active";
        chipAll.type = "button";
        chipAll.textContent = "All";
        chipAll.setAttribute("data-group", "");
        filtersEl.appendChild(chipAll);

        groups.forEach(function (g) {
          var btn = document.createElement("button");
          btn.className = "filter-chip";
          btn.type = "button";
          btn.textContent = g;
          btn.setAttribute("data-group", g);
          filtersEl.appendChild(btn);
        });

        // ── Render helpers ────────────────────────────────────────
        var gridEl = document.getElementById("catalog-grid");
        var emptyEl = document.getElementById("catalog-empty");
        var searchEl = document.getElementById("catalog-search");
        var activeGroup = "";

        function renderCards() {
          var query = searchEl.value.toLowerCase().trim();
          gridEl.innerHTML = "";
          var count = 0;

          CATALOG.forEach(function (p) {
            // Group filter
            if (activeGroup && p.group !== activeGroup) return;

            // Search filter — match name, description, or badges
            if (query) {
              var haystack = (
                p.name + " " + p.desc + " " + p.badges.join(" ")
              ).toLowerCase();
              if (haystack.indexOf(query) === -1) return;
            }

            count++;
            var card = document.createElement("article");
            card.className = "card";

            var kicker = '<p class="card-kicker">' + p.group + "</p>";

            var badgesHTML = "";
            if (p.badges.length) {
              badgesHTML = '<div class="card-badges">';
              p.badges.forEach(function (b) {
                badgesHTML += '<span class="badge">' + b + "</span>";
              });
              badgesHTML += "</div>";
            }

            card.innerHTML =
              kicker +
              badgesHTML +
              "<h2>" + p.name + "</h2>" +
              "<p>" + p.desc + "</p>" +
              '<a class="text-link" href="' + p.href + '">Browse documentation &rarr;</a>';

            gridEl.appendChild(card);
          });

          emptyEl.hidden = count > 0;
        }

        // ── Events ────────────────────────────────────────────────
        searchEl.addEventListener("input", renderCards);

        filtersEl.addEventListener("click", function (e) {
          var chip = e.target.closest(".filter-chip");
          if (!chip) return;

          // Update active chip
          filtersEl.querySelectorAll(".filter-chip").forEach(function (c) {
            c.classList.remove("is-active");
          });
          chip.classList.add("is-active");

          activeGroup = chip.getAttribute("data-group");
          renderCards();
        });

        // ── Initial render ────────────────────────────────────────
        renderCards();
      })();
    </script>
  </body>
</html>
